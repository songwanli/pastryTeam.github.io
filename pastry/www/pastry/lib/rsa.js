define(["~/lib/libex","~/lib/bigint","~/lib/md5","~/lib/sha1"],function(e,t,n,r){function i(e,n,r){var i,s,a=t.str2bigInt("65537",10),u=parseInt(e,10);5>u&&(u=5),(t.equalsInt(a,2)||t.equalsInt(a,1)||t.equalsInt(a,0))&&(a=t.str2bigInt("3",10));for(var o;;){for(;;)if(i=t.randTruePrime(u/2),!t.equalsInt(t.mod(i,a),1))break;for(;;)if(s=t.randTruePrime(u/2),!t.equals(i,s)&&!t.equalsInt(t.mod(s,a),1))break;if(o=t.mult(i,s),t.getBitSize(o)===u)break}var d=t.mult(t.addInt(i,-1),t.addInt(s,-1)),l=t.inverseMod(a,d);n.modulus=o,n.exponent=l,n.isPrivateKey=!0,r.modulus=o,r.exponent=a}function s(e,t,n){if("PKCS1Padding"===d){for(var r=2*t-e.length-6,i=n?"01":"02",s="",a=0;r>a;a++)s+=n?o[15]:o[Math.floor(15*Math.random())+1];return"00"+i+s+"00"+e}return e}function a(e){if("PKCS1Padding"===d){for(var t=0,n=0,r=e.length;r>n;n+=2)if("00"===e.substring(n,n+2)){t=n;break}return e.substring(t+2)}return e}function u(n,r,i,u,o){var l=t.getBitSize(i)/8,f;u?"PKCS1Padding"===d?f=l-11:(d=null,f=l):f=l;for(var g=[],y,b=0,c=n.length;c>b;b+=f)y=e.bytes2Hex(n.slice(b,b+f)),d||"00"!==y.substring(0,2)||(y="00",b-=f-1),u&&d&&(y=s(y,l,o)),y=t.powMod(t.str2bigInt(y,16),r,i),y=t.bigInt2str(y,16),y.length%2!==0&&(y="0"+y),!u&&d&&(y=a(y)),g=g.concat(e.hex2Bytes(y));return g}var o="0123456789ABCDEF".split(""),d="PKCS1Padding";return e.Rsa={setPaddingMode:function(e){d=e},genKeyPair:i,encrypt:function(e,t){return u(t,e.exponent,e.modulus,!0,e.isPrivateKey)},decrypt:function(e,t){return u(t,e.exponent,e.modulus,!1,e.isPrivateKey)},sign:function(t,i,s){s||(s="sha1");var a;return a="md5"===s.toLowerCase()?n.getHashByBytes(i):r.getHashByBytes(i),this.encrypt(t,e.hex2Bytes(a))},verify:function(t,i,s,a){a||(a="sha1");var u;return u="md5"===a.toLowerCase()?n.getHashByBytes(i):r.getHashByBytes(i),s=this.decrypt(t,s),e.bytes2Hex(s)===u}},e.Rsa});