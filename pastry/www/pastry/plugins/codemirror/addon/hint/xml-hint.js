!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(e,s){var n=s&&s.schemaInfo,a=s&&s.quoteChar||'"';if(n){var i=e.getCursor(),o=e.getTokenAt(i);o.end>i.ch&&(o.end=i.ch,o.string=o.string.slice(0,i.ch-o.start));var l=t.innerMode(e.getMode(),o.state);if("xml"==l.mode.name){var f=[],g=!1,c,h=/\btag\b/.test(o.type)&&!/>$/.test(o.string),p=h&&/^\w/.test(o.string),u;if(p){var d=e.getLine(i.line).slice(Math.max(0,o.start-2),o.start),m=/<\/$/.test(d)?"close":/<$/.test(d)?"open":null;m&&(u=o.start-("close"==m?2:1))}else h&&"<"==o.string?m="open":h&&"</"==o.string&&(m="close");if(!h&&!l.state.tagName||m){p&&(c=o.string),g=m;var v=l.state.context,y=v&&n[v.tagName],x=v?y&&y.children:n["!top"];if(x&&"close"!=m)for(var O=0;O<x.length;++O)c&&0!=x[O].lastIndexOf(c,0)||f.push("<"+x[O]);else if("close"!=m)for(var b in n)!n.hasOwnProperty(b)||"!top"==b||"!attrs"==b||c&&0!=b.lastIndexOf(c,0)||f.push("<"+b);v&&(!c||"close"==m&&0==v.tagName.lastIndexOf(c,0))&&f.push("</"+v.tagName+">")}else{var y=n[l.state.tagName],w=y&&y.attrs,I=n["!attrs"];if(!w&&!I)return;if(w){if(I){var P={};for(var A in I)I.hasOwnProperty(A)&&(P[A]=I[A]);for(var A in w)w.hasOwnProperty(A)&&(P[A]=w[A]);w=P}}else w=I;if("string"==o.type||"="==o.string){var d=e.getRange(r(i.line,Math.max(0,i.ch-60)),r(i.line,"string"==o.type?o.start:o.end)),M=d.match(/([^\s\u00a0=<>\"\']+)=$/),N;if(!M||!w.hasOwnProperty(M[1])||!(N=w[M[1]]))return;if("function"==typeof N&&(N=N.call(this,e)),"string"==o.type){c=o.string;var $=0;/['"]/.test(o.string.charAt(0))&&(a=o.string.charAt(0),c=o.string.slice(1),$++);var C=o.string.length;/['"]/.test(o.string.charAt(C-1))&&(a=o.string.charAt(C-1),c=o.string.substr($,C-2)),g=!0}for(var O=0;O<N.length;++O)c&&0!=N[O].lastIndexOf(c,0)||f.push(a+N[O]+a)}else{"attribute"==o.type&&(c=o.string,g=!0);for(var j in w)!w.hasOwnProperty(j)||c&&0!=j.lastIndexOf(c,0)||f.push(j)}}return{list:f,from:g?r(i.line,null==u?o.start:u):i,to:g?r(i.line,o.end):i}}}}var r=t.Pos;t.registerHelper("hint","xml",e)});