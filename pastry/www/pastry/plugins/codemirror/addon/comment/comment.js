!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function n(e){var n=e.search(i);return-1==n?0:n}var t={},i=/[^\s\u00a0]/,l=e.Pos;e.commands.toggleComment=function(e){e.toggleComment()},e.defineExtension("toggleComment",function(e){e||(e=t);for(var n=this,i=1/0,o=this.listSelections(),r=null,a=o.length-1;a>=0;a--){var m=o[a].from(),c=o[a].to();m.line>=i||(c.line>=i&&(c=l(i,0)),i=m.line,null==r?n.uncomment(m,c,e)?r="un":(n.lineComment(m,c,e),r="line"):"un"==r?n.uncomment(m,c,e):n.lineComment(m,c,e))}}),e.defineExtension("lineComment",function(e,o,r){r||(r=t);var a=this,m=a.getModeAt(e),c=r.lineComment||m.lineComment;if(!c)return(r.blockCommentStart||m.blockCommentStart)&&(r.fullLines=!0,a.blockComment(e,o,r)),void 0;var f=a.getLine(e.line);if(null!=f){var g=Math.min(0!=o.ch||o.line==e.line?o.line+1:o.line,a.lastLine()+1),s=null==r.padding?" ":r.padding,d=r.commentBlankLines||e.line==o.line;a.operation(function(){if(r.indent){for(var t=null,o=e.line;g>o;++o){var m=a.getLine(o),f=m.slice(0,n(m));(null==t||t.length>f.length)&&(t=f)}for(var o=e.line;g>o;++o){var m=a.getLine(o),u=t.length;(d||i.test(m))&&(m.slice(0,u)!=t&&(u=n(m)),a.replaceRange(t+c+s,l(o,0),l(o,u)))}}else for(var o=e.line;g>o;++o)(d||i.test(a.getLine(o)))&&a.replaceRange(c+s,l(o,0))})}}),e.defineExtension("blockComment",function(e,n,o){o||(o=t);var r=this,a=r.getModeAt(e),m=o.blockCommentStart||a.blockCommentStart,c=o.blockCommentEnd||a.blockCommentEnd;if(!m||!c)return(o.lineComment||a.lineComment)&&0!=o.fullLines&&r.lineComment(e,n,o),void 0;var f=Math.min(n.line,r.lastLine());f!=e.line&&0==n.ch&&i.test(r.getLine(f))&&--f;var g=null==o.padding?" ":o.padding;e.line>f||r.operation(function(){if(0!=o.fullLines){var t=i.test(r.getLine(f));r.replaceRange(g+c,l(f)),r.replaceRange(m+g,l(e.line,0));var s=o.blockCommentLead||a.blockCommentLead;if(null!=s)for(var d=e.line+1;f>=d;++d)(d!=f||t)&&r.replaceRange(s+g,l(d,0))}else r.replaceRange(c,n),r.replaceRange(m,e)})}),e.defineExtension("uncomment",function(e,n,o){o||(o=t);var r=this,a=r.getModeAt(e),m=Math.min(0!=n.ch||n.line==e.line?n.line:n.line-1,r.lastLine()),c=Math.min(e.line,m),f=o.lineComment||a.lineComment,g=[],s=null==o.padding?" ":o.padding,d;e:if(f){for(var u=c;m>=u;++u){var h=r.getLine(u),v=h.indexOf(f);if(v>-1&&!/comment/.test(r.getTokenTypeAt(l(u,v+1)))&&(v=-1),-1==v&&(u!=m||u==c)&&i.test(h))break e;if(v>-1&&i.test(h.slice(0,v)))break e;g.push(h)}if(r.operation(function(){for(var e=c;m>=e;++e){var n=g[e-c],t=n.indexOf(f),i=t+f.length;0>t||(n.slice(i,i+s.length)==s&&(i+=s.length),d=!0,r.replaceRange("",l(e,t),l(e,i)))}}),d)return!0}var C=o.blockCommentStart||a.blockCommentStart,p=o.blockCommentEnd||a.blockCommentEnd;if(!C||!p)return!1;var b=o.blockCommentLead||a.blockCommentLead,k=r.getLine(c),L=m==c?k:r.getLine(m),x=k.indexOf(C),R=L.lastIndexOf(p);if(-1==R&&c!=m&&(L=r.getLine(--m),R=L.lastIndexOf(p)),-1==x||-1==R||!/comment/.test(r.getTokenTypeAt(l(c,x+1)))||!/comment/.test(r.getTokenTypeAt(l(m,R+1))))return!1;var O=k.lastIndexOf(C,e.ch),E=-1==O?-1:k.slice(0,e.ch).indexOf(p,O+C.length);if(-1!=O&&-1!=E&&E+p.length!=e.ch)return!1;E=L.indexOf(p,n.ch);var M=L.slice(n.ch).lastIndexOf(C,E-n.ch);return O=-1==E||-1==M?-1:n.ch+M,-1!=E&&-1!=O&&O!=n.ch?!1:(r.operation(function(){r.replaceRange("",l(m,R-(s&&L.slice(R-s.length,R)==s?s.length:0)),l(m,R+p.length));var e=x+C.length;if(s&&k.slice(e,e+s.length)==s&&(e+=s.length),r.replaceRange("",l(c,x),l(c,e)),b)for(var n=c+1;m>=n;++n){var t=r.getLine(n),o=t.indexOf(b);if(-1!=o&&!i.test(t.slice(0,o))){var a=o+b.length;s&&t.slice(a,a+s.length)==s&&(a+=s.length),r.replaceRange("",l(n,o),l(n,a))}}}),!0)})});