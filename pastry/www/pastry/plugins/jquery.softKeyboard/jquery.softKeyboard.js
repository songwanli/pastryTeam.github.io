!function(){var e,t,n,o;o=this,t=window.clearTimeout,e=window.clearInterval,n=function(n,o,a,i){var r,u,c,d,s,f,h,l,y,p,g,k,b,m,v;r=o('<div data-softkeyboard class="fw-keyboard"></div>'),u=void 0,i=i(),k=void 0,f=!1,y=!1,l=!1,h=!1,d=void 0,s=function(e){var t,n,a;n=o(":focus"),n[0]!==e.target&&n.is("input,textarea")&&n.blur(),u&&!f&&(t=o(u.el),a=e.target,t[0]===a||t.find(a).length+r.find(a).length!==0||y||o.keyboard.hide())},b=function(e,t){e.val(t).trigger("input")},o(document).on("touchstart",function(e){y=r.find(e.target).length>0,f=!1}).on("touchmove",n.debounce(function(e){o(e.target).is("input")||(f=!0)},200,!0)).on("keydown",function(e){var t;r.is(":visible")&&(t=function(){switch(e.keyCode){case 8:return"backspace";case 13:return"done";case 38:case 16:return"shift";case 40:return"switch";case 113:return m(""),e.preventDefault()}}(),t&&(r.find("[data-keyboard-key='"+t+"']").trigger("click"),e.preventDefault()))}).on("keypress",function(e){r.is(":visible")&&(r.find("[data-keyboard-key='"+String.fromCharCode(e.which)+"']").trigger("click"),e.preventDefault())}),c=function(e){var t;if(e.stopPropagation(),t=o(e.target).attr("data-keyboard-key"),t)switch(!1){case"switch"!==t.split(":")[0]:m(t.slice(7));break;case"shift"!==t:m(u.keyboardType,"next");break;case"backspace"!==t:u.onDelete();break;case"done"!==t:u.onSubmit(v),o.keyboard.hide();break;default:u.onInput(t)}},g=function(e){e.preventDefault()},m=function(e,t){var a,i,c,d,s,f,y;null==t&&(t=0),h||l||((""===e||n.isUndefined(e))&&(d=n.keys(u.template),c=n.indexOf(d,u.keyboardType)+1,c%=d.length,e=d[c]),y=u.template[e]||u.getTemplate(e),i=y.content,n.isFunction(i)&&(y.keyList&&(y.page="next"===t?((y.page||0)+1)%y.keyList.length:t),i=i.apply(y)),i&&(u.keyboardType=e,a=n.isString(i)?o(n.trim(i)):i,f=r.height(),r.css({height:"auto",overflow:"hidden"}),r.html(a),s=r.height(),a.remove(),r.css({height:f,bottom:0}),r.append(a),u.preLayout({height:s},u.el),r.show(),l=!0,r.animate({height:s},o.keyboard.animateDuring,function(){r.css({height:"auto"}),u.onLayout({height:r.height()},u.el),l=!1})))},v="",p=o.keyboard,o.keyboard={noConflict:p,attach:function(e){var t,u,c;c=this,t=o(e.el),e=n.defaults(e,{mask:t.attr("data-mask"),random:t.attr("data-random"),keyboardType:t.attr("data-keyboard-type"),maxLength:t.attr("maxlength")||t.attr("data-v-max-len"),encryptor:t.is("[data-encryptor]")?t.attr("data-encryptor")||"default":void 0,getTemplate:function(e){return{content:n.template(o(e).html()||"")}},onInput:function(e){var n;n=t.val()+e,u?u.onInput(e,function(e){t.data("value",e),b(t,n.replace(/./g,"*"))}):b(t,n)},onDelete:function(){var e;e=t.val(),e=e.substring(0,e.length-1),u?u.onDelete(function(n){t.data("value",n),b(t,e)}):b(t,e)},onSubmit:n.noop,preLayout:o.keyboard.preLayout||n.noop,onLayout:o.keyboard.onLayout||n.noop}),t.is("input")&&/MicroMessenger|iPhone|iPad|iOS|Android/i.test(navigator.userAgent)&&t.attr("readonly","readonly"),e.encryptor&&(u=i[e.encryptor]()),t.on("click",function(){r[0].parentElement||(o("body").append(r),null!=a&&a.attach(r[0])),c.show(e)})},show:function(e){h||l||("function"==typeof e.onShow?e.onShow():void 0)===!1||(k=setInterval(function(){window.clearTimeout=function(){},window.clearInterval=function(){},r.off(),r.on("mousedown touchstart",c).on("click","[data-keyboard-key]",g),r.find("*").off()},200),u=e,m(u.keyboardType))},hide:function(){this.isShow()&&("function"==typeof u.onHide?u.onHide():void 0)!==!1&&(window.clearTimeout=t,window.clearInterval=e,e(k),u.preLayout({height:0},u.el),h=!0,r.animate({bottom:-r.height()},this.animateDuring,function(){r.hide().empty(),u.onLayout({height:0},u.el),h=!1}))},width:function(){return r.width()},height:function(){return r.height()},isShow:function(){return r.is(":visible")},getValue:function(){return v},getAnimateDuring:function(){return this.animateDuring},setAnimateDuring:function(e){this.animateDuring!==e&&(this.animateDuring=e,d&&o(document).off("click touchend",d),d=n.debounce(s,e+50),o(document).on("click touchend",d))}},o.keyboard.setAnimateDuring(200)},"undefined"!=typeof define&&define.amd?define(["underscore","jquery","fastclick","~/plugins/jquery.softKeyboard/jquery.softKeyboard.encryptor","css!~/plugins/jquery.softKeyboard/jquery.softKeyboard"],function(e,t,o,a){n(e,t,o,a)}):n(o._,o.jQuery,o.FastClick,o.encryptor)}();