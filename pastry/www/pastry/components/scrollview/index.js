console.log("def:component_scrollview"),define(["js/core","~/plugins/iscroll/iscroll"],function(e){var t="fw-loading",i=e.Component,s=e.Template,o=e.api,r=iScroll,a=o.$;i.ScrollView=i.Container.extend({initialize:function(e){this._super.apply(this,arguments),this.height=this.$el.data("height"),this.fixHeight=this.$el.data("fix-height"),this.refreshTemplate=_.template("松开手指开始载入",s.outerSettings),this.loadingTemplate=_.template("加载中...",s.outerSettings),this.minDrag=o.getTypeVal("Finite",20,e.minDrag),o.bindFunctions(this,"onRefresh","onScrollMove","onScrollEnd");var t=new RegExp("(^|\\s)iScrollHover(\\s|$)"),i=function(){this.hoverTarget&&(clearTimeout(this.hoverTimeout),this.hoverTarget.className=this.hoverTarget.className.replace(t,""),this.target=null)},h=this,l={hScrollbar:!1,vScrollbar:!1,onRefresh:this.onRefresh,onScrollMove:this.onScrollMove,onScrollEnd:this.onScrollEnd,onBeforeScrollStart:function(e){e.touches&&(h.lastY=e.touches[0].pageY);var i=e.target;for(clearTimeout(this.hoverTimeout);i&&"tr"!==i.localName;)i=i.parentNode;i&&(this.hoverTimeout=setTimeout(function(){t.test(i.className)||(i.className=i.className?i.className+" iScrollHover":"iScrollHover")},100),this.hoverTarget=i),e.preventDefault()},onBeforeScrollMove:i,onBeforeScrollEnd:i,checkDOMChanges:!0};this.page=a(".fw-page-current");var n;_.isFinite(this.height)?n=this.height:(n=this.page[0].offsetHeight-this.$el[0].offsetTop,0>=n&&(n=0),_.isFinite(this.fixHeight)&&(n+=this.$el[0].offsetTop-this.fixHeight)),this.$el.css({height:n}),this.iScroll=new r(this.el,l)},onRefresh:function(){this.refreshingData=!1;var e,i,s,r,h={},l={},n=this.$("[data-refresh-button]");n.removeClass(t);for(var c=0,f=n.length;f>c;c++)for(e=n[c].getAttribute("data-refresh-button")||"drag",i=n[c].parentNode;i!==this.$el[0];){if(_.isString(i.getAttribute("data-component"))&&_.isString(i.id)&&(s=o.getComponent(i.id),_.isObject(s)&&(r=s.onDragRefresh,_.isFunction(r)))){void 0===h[e]&&(h[e]=[]),h[e].push(n[c]),l[e]=r;break}i=i.parentNode}_.keys(h).forEach(function(e){h[e]=a(h[e]),h[e].attr("data-more-text",h[e].html())}),this.refreshBtns=h,this.refreshFuns=l},onScrollMove:function(e){if(e.touches&&((this.lastY-e.touches[0].pageY>0||this.iScroll.y>0)&&(this.page[0].scrollTop+=this.lastY-e.touches[0].pageY),this.lastY=e.touches[0].pageY),!this.refreshingData){var i,s,o=this.iScroll,r=this.refreshBtns,a=this.minDrag,h=o.maxScrollY>0?0:o.maxScrollY;o.y<h?(s="up",i=r[s],void 0===i&&(s="drag",i=r[s]),void 0!==i&&(o.y>h-a?(i.removeClass(t),i.html(i.data("more-text"))):(i.addClass(t),i.html(this.refreshTemplate({direction:s}))))):o.y>0&&(s="down",i=r[s],void 0===i&&(s="drag",i=r[s]),void 0!==i&&(o.y<a?(i.removeClass(t),i.html(i.data("more-text"))):(i.addClass(t),i.html(this.refreshTemplate({direction:s})))))}},onScrollEnd:function(){if(!this.refreshingData){var e=this,i=this.refreshBtns,s=this.refreshFuns;_.keys(i).forEach(function(o){var r=i[o],a;r.hasClass(t)&&(r.html(e.loadingTemplate({direction:o})),a=s[o],_.isFunction(a)&&(e.refreshingData=!0,a(o)))})}}})});