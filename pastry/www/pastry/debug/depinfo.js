var hasProp={}.hasOwnProperty;console.log("def:debug_depinfo"),define(["js/api","~/debug/titlebar_menu","dependency"],function(e,n,t){var i,a,o,r,l,d,c,f,s,u,h,p,g,v,y,m,x,b,w,T;return r=e.CONST,r.IE_FLAG?void 0:(i=e.$,l=e._,f="map",o=i("#dependencyInfo"),0===o.length&&(o=i('<div style="position:absolute;bottom:0;z-index:9999;background:#eeeeee;opacity:0.8;text-align:right">\n  <input data-action="map" type="button" value="拓扑图"/>\n  <input data-action="matrix" type="button" value="邻接矩阵"/>\n  <input data-action="close" type="button" value="X"/>\n  <div><canvas></canvas></div>\' +\n</div>'),i(document.body).append(o),o.hide()),a=o.find("canvas"),d=a[0],c=d.getContext("2d"),o.find("input").on("click",function(e){var n,t;switch(n=i(e.currentTarget),t=n.attr("data-action"),t){case"map":case"matrix":return f=t,v(p.map,p.order);case"close":return o.hide()}}),s=void 0,u=void 0,b=0,w=0,a.on("mousemove",function(e){var n;1===e.which&&(n=T(d,e.clientX,e.clientY),b=s+n.x,w=u+n.y,c.setTransform(1,0,0,1,b,w),v(p.map,p.order))}),a.on("mousedown",function(e){var n;n=T(d,e.clientX,e.clientY),s=b-n.x,u=w-n.y}),T=function(e,n,t){var i;return i=e.getBoundingClientRect(),{x:n-i.left*(e.width/i.width),y:t-i.top*(e.height/i.height)}},g={},x=function(e,n,t){g[e]={x:n,y:t}},h=function(e){return g[e]||{x:0,y:0}},p={},v=function(e,n){switch(p.map=e,p.order=n,c.save(),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,d.width,d.height),c.restore(),f){case"map":return y(e,n);case"matrix":return m(e,n)}},y=function(e,n){var i,a,o,r,d,f,s,u,p,g,v,y;for(console.log(n),c.font="8px",i=d=0,p=n.length;p>=0?p>d:d>p;i=p>=0?++d:--d)for(r=f=0,g=n[i].length;g>=0?g>f:f>g;r=g>=0?++f:--f)if(v=80*i+30,y=40*r+30,c.fillStyle="black",c.fillText(n[i][r],v+5,y-5),c.beginPath(),c.fillStyle=t.isEnable(n[i][r])?"green":"red",c.arc(v,y,5,0,2*Math.PI,!1),c.fill(),c.beginPath(),c.fillStyle=t.isReady(n[i][r])?"green":"red",c.arc(v,y+10,3,0,2*Math.PI,!1),c.fill(),x(n[i][r],v,y),a=e[n[i][r]].i,!l.isUndefined(a))for(u=0,s=a.length;s>u;u++)o=a[u],o=h(o),c.beginPath(),c.moveTo(v,y),c.lineTo(o.x,o.y),c.stroke()},m=function(e,n){var t,i,a,o,r,d,f,s,u,h,p,g,v,y,m;if(c.fillStyle="black",t=l.flatten(n),h=20,p=30,null===t){t=[];for(a in e)hasProp.call(e,a)&&(v=e[a],t.push(a),o=v.i,l.isUndefined(o)||(t=t.concat(o)));t=l.uniq(t).sort()}for(u=t.length,i=d=0,g=u;g>=0?g>d:d>g;i=g>=0?++d:--d)y=h+80*(i+1),m=p,c.fillText(t[i],y,m),y=h,m=p+20*(i+1),c.fillText(t[i],y,m);for(a in e)if(hasProp.call(e,a)&&(v=e[a],y=l.indexOf(t,a),o=v.i,!l.isUndefined(o)))for(f=0,s=o.length;s>f;f++)r=o[f],m=l.indexOf(t,r),c.fillText("1",h+80*(y+1),p+20*(m+1))},t.afterCalc=function(e,n){d.width=i(window).innerWidth(),d.height=i(window).innerHeight()/2,c=d.getContext("2d"),c.transform(1,0,0,1,b,w),v(e,n)},n.addMenu({id:"showDepInfo",title:"DI",callback:function(){"none"===o.css("display")?o.show():o.hide()}}))});